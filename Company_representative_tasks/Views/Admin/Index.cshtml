@model IEnumerable<Company_representative_tasks.Models.User>
@{
    ViewData["Title"] = "Admin Dashboard";
    if (ViewBag.CloudflaredLink == null)
    {
        <meta http-equiv="refresh" content="5">
    }
}
<div class="text-end mb-3">
    <form asp-controller="Account" asp-action="Logout" method="post">
        <button type="submit" class="btn btn-danger">Logout</button>
    </form>
</div>
<div class="mb-3">
    <form asp-controller="Admin" asp-action="GenerateNgrokLink" method="post" style="display:inline-block;">
        <button type="submit" class="btn btn-primary">Generate Agents Public Link</button>
    </form>
    <form asp-controller="Admin" asp-action="StopNgrok" method="post" style="display:inline-block; margin-left:10px;">
        <button type="submit" class="btn btn-warning">Stop Public link</button>
    </form>
</div>
<h2>Admin Dashboard</h2>
<div class="mb-2">
    <strong>Status:</strong> @ViewBag.NgrokStatus
</div>
@if (TempData["NgrokOutput"] != null)
{
    <div class="alert alert-info">@Html.Raw(TempData["NgrokOutput"])</div>
}
@if (ViewBag.NgrokLink != null)
{
    <div class="alert alert-success">
        Agents Link: <a href="@ViewBag.NgrokLink" target="_blank">@ViewBag.NgrokLink</a>
    </div>
}
<table class="table table-bordered">
    <thead>
        <tr>
            <th>User Name</th>
            <th>Email</th>
            <th>Tasks</th>
            <th>Invoices</th>
            <th>Notes</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var user in Model)
    {
        <tr>
            <td>@user.Name</td>
            <td>@user.Email</td>
            <td>
                <ul>
                @foreach (var task in user.Tasks ?? new List<Company_representative_tasks.Models.Task>())
                {
                    <li>@task.Title</li>
                }
                </ul>
            </td>
            <td>
                <ul>
                @foreach (var invoice in user.Invoices ?? new List<Company_representative_tasks.Models.Invoice>())
                {
                    <li>@invoice.Number</li>
                }
                </ul>
            </td>
            <td>
                <ul>
                @foreach (var note in user.Notes ?? new List<Company_representative_tasks.Models.Note>())
                {
                    <li>@note.Content</li>
                }
                </ul>
            </td>
        </tr>
    }
    </tbody>
</table>